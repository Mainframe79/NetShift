<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v5/wxs"
     xmlns:bal="http://wixtoolset.org/schemas/v5/wxs/bal"
     xmlns:util="http://wixtoolset.org/schemas/v5/wxs/util"
     xmlns:netfx="http://wixtoolset.org/schemas/v5/wxs/netfx">
	<Bundle Name="NetShift Installer"
			Version="1.0.0.1"
			Manufacturer="ZentrixLabs"
			UpgradeCode="{CB234246-E944-4501-AF6C-B57678F04C1F}"
			Compressed="yes">
		<BootstrapperApplicationRef Id="WixStandardBootstrapperApplication">
			<bal:WixStandardBootstrapperApplication Theme="hyperlink" />
		</BootstrapperApplicationRef>

		<Chain>
			<!-- .NET Framework 4.8 Web Installer -->
			<PackageGroupRef Id="NetFx48Web" />

			<!-- .NET 8 Runtime (x64) -->
			<ExePackage Id="Net8Runtime"
						Cache="remove"
						Compressed="no"
						PerMachine="yes"
						Permanent="yes"
						Vital="yes"
						SourceFile="dotnet-runtime-8.0-win-x64.exe"
						DownloadUrl="https://download.visualstudio.microsoft.com/download/pr/1b38f1d9-1e5d-4a91-97f1-2d0f6c7f6c7f/dotnet-runtime-8.0.0-win-x64.exe"
						InstallArguments="/install /quiet /norestart"
						DetectCondition="Net8RuntimeInstalled">
				<ExitCode Behavior="success" Value="0" />
				<ExitCode Behavior="forceReboot" Value="3010" />
			</ExePackage>

			<!-- Main MSI Package -->
			<MsiPackage Id="NetShiftSetup"
						SourceFile="bin\x64\Release\NetShiftSetup.msi"
						Compressed="yes"
						Vital="yes" />
		</Chain>

		<!-- Detect .NET 8 Runtime -->
		<util:RegistrySearch Id="CheckNet8Runtime"
							 Root="HKLM"
							 Key="SOFTWARE\dotnet\Setup\InstalledVersions\x64\sharedfx\Microsoft.WindowsDesktop.App"
							 Value="8.0.0"
							 Variable="Net8RuntimeVersion"
							 Result="exists" />
		<Variable Name="Net8RuntimeInstalled" Value="0" />
		<SetVariable Name="Net8RuntimeInstalled" Value="1" Condition="Net8RuntimeVersion" />
	</Bundle>
</Wix>